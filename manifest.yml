app:
  id: ari:cloud:ecosystem::app/1c0636dd-b020-48a5-b68b-0d3f2fe06134
  connect:
    key: com.not-atlassian.connect.entity-property-tool.dev
    remote: connect
  features:
    autoUserConsent: true
  runtime:
    name: nodejs18.x
remotes:
  - key: connect
    baseUrl: https://rmassaioli.public.atlastunnel.com
modules:
  ## TODO Use jira:adminPage for all other entity property types
  jira:globalPage:
    - key: entity-properties-global
      title: Entity properties
      icon: resource:main;entity-properties-icon.svg
      resource: main
      resolver:
        function: resolver
      pages:
        - title: User entity properties
          route: user
        - title: Issue Type entity properties
          route: issue-type
        - title: Dashboard Item entity properties
          route: dashboard-items
        - title: Workflow Transition entity properties
          route: workflow-transitions
  jira:projectPage:
    - key: project-entity-properties
      title: Entity properties
      icon: resource:main;entity-properties-icon.svg
      resource: main
      resolver:
        function: resolver
  jira:issuePanel:
    - key: issue-entity-properties
      title: Entity properties
      icon: resource:main;entity-properties-icon.svg
      resource: main
      resolver:
        function: resolver
  function:
    - key: resolver
      handler: index.handler
resources:
  - key: main
    path: static/hello-world/build
    tunnel:
      port: 3001
connectModules:
  jira:configurePage:
    - url: /page/configuration
      icon:
        width: 80
        height: 80
        url: /maps/icon.png
      key: configuration-page
      name:
        value: Entity property tool configuration
  jira:jiraIssueTabPanels:
    - url: /panel/issue?issue_id={issue.id}&issue_key={issue.key}
      weight: 100
      key: issue-entity-tab
      name:
        value: Entity properties
      conditions:
        - condition: user_is_logged_in
        - or:
            - condition: entity_property_equal_to
              invert: true
              params:
                entity: addon
                propertyKey: ep-tool.disabled-for-all
                value: 'true'
            - condition: entity_property_equal_to
              params:
                entity: user
                propertyKey: ep-tool.enabled-for-me
                value: 'true'
  jira:jiraProjectPages:
    - key: project-entity-properties-general-page
      name:
        value: Entity properties (old)
      url: /panel/project?project_id={project.id}&project_key={project.key}
      weight: 1000
      tooltip:
        value: Project entity properties browser
      iconUrl: /static/images/entity-properties-icon.svg
      conditions:
        - condition: user_is_logged_in
        - or:
            - condition: entity_property_equal_to
              invert: true
              params:
                entity: addon
                propertyKey: ep-tool.disabled-for-all
                value: 'true'
            - condition: entity_property_equal_to
              params:
                entity: user
                propertyKey: ep-tool.enabled-for-me
                value: 'true'
  jira:generalPages:
    - key: user-entity-properties-general-page
      name:
        value: User entity properties
      url: /panel/user
      location: not-a-valid-location
    - key: issue-type-entity-properties-general-page
      name:
        value: Issue type entity properties
      url: /panel/issue-type
      location: not-a-valid-location
  jira:webItems:
    - key: issue-type-entitiy-properties-web-item
      name:
        value: Entity properties
      url: issue-type-entity-properties-general-page
      location: element_options_section/issue_types_section
      weight: 1000
      tooltip:
        value: Entity properties browser for issue types
      context: page
      conditions:
        - condition: user_is_logged_in
        - or:
            - condition: entity_property_equal_to
              invert: true
              params:
                entity: addon
                propertyKey: ep-tool.disabled-for-all
                value: 'true'
            - condition: entity_property_equal_to
              params:
                entity: user
                propertyKey: ep-tool.enabled-for-me
                value: 'true'
    - key: user-entitiy-properties-web-item
      name:
        value: Entity properties
      url: user-entity-properties-general-page
      location: system.user.options/personal
      weight: 1000
      tooltip:
        value: Entity properties browser for you
      context: page
permissions:
  scopes:
    - read:connect-jira
    - write:connect-jira
    - delete:connect-jira
    - project-admin:connect-jira
    - admin:connect-jira
    - read:jira-work
    - write:jira-work
    - manage:jira-project
    - read:jira-user
  content:
    styles:
      - unsafe-inline
